<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>My Google Map</title>
  <style>
    #map{
      height:600px;
      width:100%;
    }
  </style>
</head>
<body>
  <h1>My Google Map</h1>
  <div id="map"></div>
  <p id="GPS"></p>
  <script type="text/javascript" src="./exif.js"></script>
  <script>

    function initMap(){
      // Map options
      var options = {
        zoom:8,
        center:{lat:42.3601,lng:-71.0589}
      }

      // New map
      var map = new google.maps.Map(document.getElementById('map'), options);

      // Listen for click on map
      // google.maps.event.addListener(map, 'click', function(event){
      //   // Add marker
      //   addMarker({coords:event.latLng});
      // });

      /*
      // Add marker
      var marker = new google.maps.Marker({
        position:{lat:42.4668,lng:-70.9495},
        map:map,
        icon:'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png'
      });

      var infoWindow = new google.maps.InfoWindow({
        content:'<h1>Lynn MA</h1>'
      });

      marker.addListener('click', function(){
        infoWindow.open(map, marker);
      });
      */

      // Array of markers
      var img = document.createElement('img');
      img.src = './Baby_pig.jpg'; 
      img.height=200;

      var img2 = document.createElement('img');
      img2.src = './Demonology'+2+'LogoNew.jpg'; 
      img2.height=200;

      var markers = [
        {
          coords:{lat:42.4668,lng:-70.9495},
          iconImage:'https://img.icons8.com/color/48/000000/error.png',
          content:img
        },
        {
          coords:{lat:42.8584,lng:-70.9300},
          iconImage:'https://img.icons8.com/color/48/000000/error.png',
          content:img2
        }
      ];
      
      // Add new markers
      var lat = 42.7762;
      var lng = -71.9300;

      markers.push(
        {
          coords:{lat:lat,lng:lng},
          iconImage:'https://img.icons8.com/color/48/000000/error.png',
          content:img
        }
      );


      for (var i=0; i<3;i++) {
        var img3 = document.createElement('img');
        img3.src = './Demonology'+i+'LogoNew.jpg'; 
        img3.height=200;

        lat = lat+(i+1)*0.01;

        markers.push(
        {
          coords:{lat:lat,lng:lng},
          iconImage:'https://img.icons8.com/color/48/000000/error.png',
          content:img3
        }
        );
      }

      // var img4 = document.createElement('img'); 
      // img4.src = './DSCN0012.jpg';
      // img4.height=200;
      function ConvertDMSToDD(degrees, minutes, seconds, direction) {
    
          var dd = degrees + (minutes/60) + (seconds/3600);
          
          if (direction == "S" || direction == "W") {
              dd = dd * -1; 
          }
          
          return dd;
      } 

      function CreateImgMarker(imgPath){

        var imgLat = 0;
        var imgLng = 0;

        var img4 = document.createElement('img');
        img4.height=200;
        img4.onload = function () {
          EXIF.getData(this, 
            function() {

              var myData = this;
              
              // Calculate latitude decimal
              var latDegree = myData.exifdata.GPSLatitude[0];
              var latMinute = myData.exifdata.GPSLatitude[1];
              var latSecond = myData.exifdata.GPSLatitude[2];
              var latDirection = myData.exifdata.GPSLatitudeRef;

              var latFinal = ConvertDMSToDD(latDegree, latMinute, latSecond, latDirection);

              // Calculate longitude decimal
              var lonDegree = myData.exifdata.GPSLongitude[0];
              var lonMinute = myData.exifdata.GPSLongitude[1];
              var lonSecond = myData.exifdata.GPSLongitude[2];
              var lonDirection = myData.exifdata.GPSLongitudeRef;

              var lonFinal = ConvertDMSToDD(lonDegree, lonMinute, lonSecond, lonDirection);

              imgLat = latFinal;
              imgLng = lonFinal;

              document.getElementById('GPS').innerHTML = 'Lattitude : ' + latFinal + "   Longitude : " + lonFinal;
              var newMarker = {
                coords:{lat:imgLat,lng:imgLng},
                iconImage:'https://img.icons8.com/color/48/000000/error.png',
                content:img4
              }
              
              addMarker(newMarker);

            });
        }

        img4.src = imgPath;
      }


      CreateImgMarker("./cathedral.jpg");

      CreateImgMarker("./IMG_20190709_225331.jpg");

      CreateImgMarker("./DSCN0012.jpg")
      


      // Loop through markers
      for(var i = 0;i < markers.length;i++){
        // Add marker
        addMarker(markers[i]);
      }

      // Add Marker Function
      function addMarker(props){
        var marker = new google.maps.Marker({
          position:props.coords,
          map:map,
          //icon:props.iconImage
        });

        // Check for customicon
        if(props.iconImage){
          // Set icon image
          marker.setIcon(props.iconImage);
        }

        // Check content
        if(props.content){
          var infoWindow = new google.maps.InfoWindow({
            content:props.content
          });

          marker.addListener('click', function(){
            infoWindow.open(map, marker);
          });
        }
      }
    }
  </script>
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDYGCfvJ1erL6N98R6IyBHAytkWoMoAI9s&callback=initMap">
    </script>
</body>
</html>
